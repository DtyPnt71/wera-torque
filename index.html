<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Drehmomentkorrektur WERA</title>
<link href="manifest.json" rel="manifest"/>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    body { background: #121212; color: #fff; font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
    h1 { text-align: center; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    select, input, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: none; background: #1e1e1e; color: #fff; }
    button { background-color: #ff5252; margin-top: 20px; cursor: pointer; }
    #result { margin-top: 20px; color: red; font-size: 1.2em; text-align: center; }
    .warning { margin-top: 30px; color: #ffc107; font-size: 0.9em; text-align: center; }
    footer { margin-top: 40px; text-align: center; font-size: 0.75em; color: #bbb; }
    .modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.7);
  overflow-y: auto;
}
    .modal-content {
  background: #222;
  padding: 20px;
  border-radius: 5px;
  width: 90%;
  max-width: 500px;
  text-align: left;
  color: #eee;
  margin: 20px auto;
}
    .modal-content button { margin-top: 15px; background: #ff5252; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; width: 100%; }
    .modal-content h1, h2, h3 { color: #ffcc00; }
    .modal-content ul, ol { margin-left: 20px; }
  </style>
<link href="styles.css" rel="stylesheet"/>
</head>
<body class="dark">
<div class="animated-intro" id="intro">
<div class="animated-logo">
<img alt="Logo" src="icon-192.png"/>
<h2>Drehmomentkorrektur</h2>
<p>Pr√§zise. Einfach. WERA.</p>
</div>
</div>
<div class="button-bar"><button id="langBtn" onclick="switchLanguage()">üåê Sprache: DE</button><button onclick="toggleTheme()">üåì Dark/Light Mode</button><button id="install-btn" style="display:block;">üì≤ App installieren</button><button class="changelog-btn" onclick="showChangelog()">üìã Changelog anzeigen</button></div><h1 id="title">Drehmomentkorrektur WERA</h1>
<label for="insertType">Werkzeugeinsatz</label>
<select id="insertType">
<option value="">-- ausw√§hlen --</option>
<option value="Joker L">Joker L (14x18)</option>
<option value="Joker XL">Joker XL (14x18)</option>
<option value="Joker XXL">Joker XXL (14x18)</option>
<option value="Joker 3XL">Joker 3XL (14x18)</option>
</select>
<label for="sw">Schl√ºsselweite</label>
<select disabled="" id="sw">
<option value="">-- zuerst Werkzeugeinsatz w√§hlen --</option>
</select>
<label for="keyType">Drehmomentschl√ºssel</label>
<select id="keyType">
<option value="">-- ausw√§hlen --</option>
<option value="X4">WERA X4 (40‚Äì200 Nm)</option>
<option value="X7">WERA X7 (20‚Äì100 Nm)</option>
</select>
<label for="ma">Drehmoment in Nm</label>
<input id="ma" min="0" type="number"/>
<button class="calculate-btn" onclick="calculate()">Jetzt berechnen</button><button class="reset-btn" onclick="resetFields()">Zur√ºcksetzen</button>
<div class="result" id="result"></div><div class="loader-bar" id="loader" style="display: none;"></div>
<div class="warning">
    ‚ö†Ô∏èAchtung<br/>
	Werte au√üerhalb der Schl√ºsselbereiche k√∂nnen zu dauerthaften Sch√§den f√ºhren!<br/>
    Bitte beachten Sie, dass das √úberschreiten der zul√§ssigen Drehmoment- oder Schl√ºsselweitenbereiche irreversible Sch√§den verursachen kann.<br/>
<br/>
	Da die Werkzeugeinsatzl√§nge, Ausschwenkwinkel bei variabler Schl√ºsselweite, sowie der effektive Hebelarm des Drehmomentschl√ºssels, das Messergebnis ma√ügeblich beeinflussen<br/>
	ist deshalb eine Korrektur erforderlich.<br/>
<br/>___________________________‚ùó‚ùó‚ùó‚ùó__________________________<br/>
	Die Verwendung dieses Tools erfolgt ausschlie√ülich auf eigenes Risiko, und f√ºr daraus resultierende Sch√§den wird keinerlei Haftung √ºbernommen.
	<br/>______________________________________________________________<br/>
</div>
<footer><div>Version wird geladen‚Ä¶</div>Erstellt durch Timo Burian ‚Äì HDT GmbH, 46242 Bottrop<div style="font-size: 0.8em; margin-top: 10px;">¬© 2025 ‚Äì Nutzung nur unter <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></div></footer>
<div class="modal" id="modal" onclick="this.style.display='none'">
<div class="modal-content">
<div id="modalText"></div>
<button onclick="document.getElementById('modal').style.display='none'">OK</button>
</div>
</div>
<div class="modal" id="modalChangelog" onclick="this.style.display='none'">
<div class="modal-content">
<div id="modalChangelogText" style="max-height: 60vh; overflow-y: auto;"></div>
<button onclick="document.getElementById('modalChangelog').style.display='none'">Schlie√üen</button>
</div>
</div>
<script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }

    const sizes = {
      "Joker L": { "16": 44.6, "17": 46.7, "18": 48.2, "19": 49.1 },
      "Joker XL": { "19": 51.6, "20": 53.6, "21": 55.4, "22": 56.7, "23": 56.7, "24": 56.7 },
      "Joker XXL": { "24": 62.2, "27": 68, "30": 70.2, "32": 70.4 },
      "Joker 3XL": { "32": 77, "34": 79, "36": 80, "41": 81.5 }
    };

    const data = {
      X4: { Lk: 435, Sk: 25.5, min: 40, max: 200 },
      X7: { Lk: 343, Sk: 25.5, min: 20, max: 100 }
    };

    document.getElementById("insertType").addEventListener("change", function () {
      const type = this.value;
      const sw = document.getElementById("sw");
      sw.innerHTML = '';
      if (!sizes[type]) {
        sw.disabled = true;
        sw.innerHTML = '<option value="">-- zuerst Werkzeugeinsatz w√§hlen --</option>';
        return;
      }
      sw.disabled = false;
      sw.innerHTML = '<option value="">-- ausw√§hlen --</option>';
      Object.keys(sizes[type]).forEach(val => {
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = `SW ${val}`;
        sw.appendChild(opt);
      });
    });

    function showModal(txt) {
      document.getElementById("modalText").innerText = txt;
      document.getElementById("modal").style.display = "block";
    }

    function showAddToHome() {
      showModal("üì≤ So f√ºgst du die App zum Startbildschirm hinzu:\n\nüì± Android: Men√º > 'Zum Startbildschirm hinzuf√ºgen'\nüçè iOS: Teilen-Symbol > 'Zum Homebildschirm'");
    }

    function calculate() {
      const insert = document.getElementById("insertType").value;
      const sw = document.getElementById("sw").value;
      const key = document.getElementById("keyType").value;
      const ma = parseFloat(document.getElementById("ma").value);
      const resultDiv = document.getElementById("result");
      resultDiv.innerText = "";

      if (!insert || !sw || !key || isNaN(ma)) {
        showModal("Bitte f√ºlle alle Felder korrekt aus.");
        return;
      }

      const S = sizes[insert][sw];
      const { Sk, Lk, min, max } = data[key];
      const Ms = ma * Lk / (Lk + (S - Sk));
      const rounded = Math.round(Ms * 100) / 100;

      if (rounded < min || rounded > max) {
        showModal(`Das Ergebnis (${rounded} Nm) liegt au√üerhalb des Bereichs vom WERA ${key}.`);
      }

      resultDiv.innerText = `korrigierter Wert: ${rounded} Nm`;
    }

    function showChangelog() {
      fetch("https://raw.githubusercontent.com/DtyPnt71/wera-torque/main/README.md")
        .then(response => response.text())
        .then(data => {
          document.getElementById("modalChangelogText").innerHTML = marked.parse(data);
          document.getElementById("modalChangelog").style.display = "block";
        })
        .catch(() => {
          alert("Changelog konnte nicht geladen werden.");
        });
    }
  </script>
<script src="install.js"></script>
<script src="script.js"></script><script>
fetch('./version.json')
  .then(res => res.json())
  .then(data => {
    const footer = document.querySelector('footer');
    if (footer) {
      footer.querySelector('div').innerText = 'Version ' + data.version;
    }
  })
  .catch(() => {
    console.warn('Version konnte nicht geladen werden.');
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js').then(function(reg) {
          console.log('ServiceWorker registered:', reg);
        });
      });
    }
  </script>
  <meta charset="UTF-8" />
  <title>Drehmomentkorrektur WERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.8em;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    select, input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      font-size: 1em;
      border: none;
      background-color: #1e1e1e;
      color: white;
    }

    button {
      background-color: #ff5252;
      margin-top: 20px;
      cursor: pointer;
    }

    button:hover {
      background-color: #ff7979;
    }

    #result {
      margin-top: 25px;
      color: red;
      font-weight: bold;
      font-size: 1.4em;
      text-align: center;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000;
    }

    .modal-content {
      background-color: #222;
      padding: 20px;
      border-radius: 10px;
      margin: 20% auto;
      width: 80%;
      max-width: 400px;
      text-align: center;
      color: white;
    }

    .modal-content button {
      margin-top: 15px;
      background-color: #ff5252;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: white;
    }

    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 0.7em;
      color: #C0C0C0;
    }

    .warning {
      margin-top: 30px;
      background-color: rgba(255,193,7,0.1);
      color: #ffc107;
      border-left: 4px solid #ffc107;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<h1>Drehmomentkorrektur WERA</h1>

<label for="insertType">Werkzeugeinsatz</label>
<select id="insertType">
  <option value="">-- ausw√§hlen --</option>
  <option value="Joker L">Joker L</option>
  <option value="Joker XL">Joker XL</option>
  <option value="Joker XXL">Joker XXL</option>
  <option value="Joker 3XL">Joker 3XL</option>
</select>

<label for="sw">Schl√ºsselweite</label>
<select id="sw">
  <option value="">-- zuerst Einsatz w√§hlen --</option>
</select>

<label for="keyType">Drehmomentschl√ºssel</label>
<select id="keyType">
  <option value="">-- ausw√§hlen --</option>
  <option value="X4">WERA X4 (40‚Äì200 Nm)</option>
  <option value="X7">WERA X7 (20‚Äì100 Nm)</option>
</select>

<label for="ma">"Ist" Drehmoment in Nm</label>
<input type="number" id="ma" min="0" />

<button onclick="calculate()">Berechnen</button>
<button onclick="showAddToHome()">Zur Startseite hinzuf√ºgen</button>

<div id="result"></div>

<div class="warning">
  ‚ö†Ô∏è Achtung: Werte au√üerhalb der Schl√ºsselbereiche k√∂nnen zu falscher Anwendung f√ºhren!<br>
  Die Korrektur ist notwendig, da Werkzeugeinsatzl√§nge, Ausschwenkwinkel bei variabler Schl√ºsselweite und Hebelarm des Drehmomentschl√ºssels Einfluss auf das Ergebnis haben.
</div>

<footer>
  Erstellt durch Timo Burian ‚Äì HDT GmbH, 46242 Bottrop
</footer>

<div class="modal" id="modal">
  <div class="modal-content">
    <div id="modalText"></div>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
  const sizes = {
    "Joker L": { "16": 44.6, "17": 46.7, "18": 48.2, "19": 49.1 },
    "Joker XL": { "19": 51.6, "20": 53.6, "21": 55.4, "22": 56.7, "23": 56.7, "24": 56.7 },
    "Joker XXL": { "24": 62.2, "27": 68, "30": 70.2, "32": 70.4 },
    "Joker 3XL": { "32": 77, "34": 79, "36": 80, "41": 81.5 }
  };

  const data = {
    X4: { Lk: 435, Sk: 25.5, min: 40, max: 200 },
    X7: { Lk: 343, Sk: 25.5, min: 20, max: 100 }
  };

  document.getElementById("insertType").addEventListener("change", function() {
    const type = this.value;
    const swSelect = document.getElementById("sw");
    swSelect.innerHTML = '<option value="">-- SW ausw√§hlen --</option>';
    if (sizes[type]) {
      Object.entries(sizes[type]).forEach(([key, val]) => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = `SW ${key}`;
        swSelect.appendChild(opt);
      });
    }
  });

  function showModal(message) {
    document.getElementById("modalText").innerText = message;
    document.getElementById("modal").style.display = "block";
  }

  function closeModal() {
    document.getElementById("modal").style.display = "none";
  }

  function showAddToHome() {
    showModal("üì≤ So f√ºgst du die App zum Startbildschirm hinzu:

üì± Android: Men√º > 'Zum Startbildschirm hinzuf√ºgen'
üçè iOS: Teilen-Symbol > 'Zum Home-Bildschirm'");
  }

  function calculate() {
    const insert = document.getElementById("insertType").value;
    const sw = document.getElementById("sw").value;
    const key = document.getElementById("keyType").value;
    const ma = parseFloat(document.getElementById("ma").value);

    if (!insert || !sw || !key || isNaN(ma)) {
      showModal("Bitte f√ºlle alle Felder korrekt aus.");
      return;
    }

    const S = sizes[insert][sw];
    const { Sk, Lk, min, max } = data[key];
    const Ms = ma * Lk / (Lk + (S - Sk));
    const rounded = Math.round(Ms * 100) / 100;

    if (rounded < min || rounded > max) {
      showModal(`Das Ergebnis (${rounded} Nm) liegt au√üerhalb des Bereichs vom WERA ${key}.`);
    }

    document.getElementById("result").innerText = `korrigierter Wert: ${rounded} Nm`;
  }
</script>

</body>
</html>